pico-8 cartridge // http://www.pico-8.com
version 43
__lua__
--ghost game

function _init()
	init_player()
	init_lights()
end

function _update()
	update_player()
	update_lights()
end

function _draw()
	cls()
	draw_lights()
	draw_player()
end

-->8
--player

function init_player()
	player = {
		x = 60,
		y = 60,
		r = 4,
		sprite = 1,
		size = 1,
		flip = false
	}
end

function update_player()
	--movement
	if btn(⬅️) then
		player.x -= 1
		player.flip = false
	end
	if btn(➡️) then
		player.x += 1
		player.flip = true
	end
	if btn(⬆️) then
		player.y -= 1
	end
	if btn(⬇️) then
		player.y += 1
	end

	--check boundary
	if player.x < 0 then
		player.x = 0
	elseif player.x > 120 then
		player.x = 120
	elseif player.y < 0 then
		player.y = 0
	elseif player.y > 120 then
		player.y = 120
	end
end

function draw_player()
	spr(
		player.sprite,
		player.x,
		player.y,
		player.size,
		player.size,
		player.flip
	)
end

-->8
--lights

function init_lights()
	lights = {}
	max_lights = 10
	max_size = 8
	color = 10
	speed = 0.6
end

function create_light()
	local x, y, dx, dy = 0, 0, 0, 0
	local spawn = flr(rnd(4))

	if spawn < 2 then
		y = flr(rnd(128))
		dy = rnd(speed * 2) - speed

		if spawn == 0 then
			--left
			x, dx = -8, rnd(speed)
		else
			--right
			x, dx = 135, -rnd(speed)
		end
	else
		x = flr(rnd(128))
		dx = rnd(speed * 2) - speed

		if spawn == 2 then
			--top
			y, dy = -8, rnd(speed)
		else
			--bottom
			y, dy = 135, -rnd(speed)
		end
	end

	local light = {
		x = x,
		y = y,
		dx = dx,
		dy = dy,
		r = ceil(rnd(max_size))
	}

	add(lights, light)
end

function update_lights()
	if #lights < max_lights then
		create_light()
	end

	for light in all(lights) do
		--movement
		light.x += light.dx
		light.y += light.dy

		--outside screen
		if light.x < -8
				or light.x > 135
				or light.y < -8
				or light.y > 135 then
			del(lights, light)
		end

		check_collision(light)
	end
end

function draw_lights()
	for light in all(lights) do
		circfill(
			light.x,
			light.y,
			light.r,
			color
		)
	end
end

-->8
--collision

function check_collision(light)
	local x = player.x + player.r
	local y = player.y + player.r
	diff_x = (x - light.x) ^ 2
	diff_y = (y - light.y) ^ 2
	dist_sq = diff_x + diff_y

	if dist_sq < light.r ^ 2 then
		_init()
	end
end

__gfx__
00000000007777000077770000aaaa0000aaaa000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000007777770077777700aaaaaa00aaaaaa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0070070007877870078778700a8aa8a00a8aa8a00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0007700007777770077777700aaaaaa00aaaaaa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0007700007777770077777700aaaaaa00aaaaaa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0070070007777700077777000aaaaa000aaaaa000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000007770000077770000aaa00000aaaa000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000000000007770000007770000aaa000000aaa00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000007777700000000000000000000000000000000000000000000000000000000000777770000000000000000000000000000000000000000000000000
00000000077777770077000000000077770000000777770077777777770000000000000007777777007700000000007777000000077777007777777777000000
00000000777007770077000077000777777700007777770077777777770000000000000077700777007700007700077777770000777777007777777777000000
00000000777000000077000077000777777700007770000000007700000000000000000077700000007700007700077777770000777000000000770000000000
00000007770000000077000077007770007770007700000000007700000000000000000777000000007700007700777000777000770000000000770000000000
00000007770000000077000077007770007770007700000000007700000000000000000777000000007700007700777000777000770000000000770000000000
00000007700000000077777777007700000770007770000000007700000000000000000770000000007777777700770000077000777000000000770000000000
00000007700000000077777777007700000770007777000000007700000000000000000770000000007777777700770000077000777700000000770000000000
00000007700007700077700077007700000770000777700000007700000000000000000770000770007770007700770000077000077770000000770000000000
00000007700007700777000077007770000770000077700000007700000000000000000770000770077700007700777000077000007770000000770000000000
00000007700077700777000077007770007770000007770000007700000000000000000770007770077700007700777000777000000777000000770000000000
00000007770777700770000077000777077700077707770000007700000000000000000777077770077000007700077707770007770777000000770000000000
00000007777777700770000077000777777700077777770000007700000000000000000777777770077000007700077777770007777777000000770000000000
00000000777777700770000077000077777000007777770000007700000000000000000077777770077000007700007777700000777777000000770000000000
00000000000007700000000000000000000000000777000000007700000000000000000000000770000000000000000000000000077700000000770000000000
00000000000007700000000000000000000000000000000000007700000000000000000000000770000000000000000000000000000000000000770000000000
00000000000007700000000000000000000000000000000000007700000000000000000000000770000000000000000000000000000000000000770000000000
00000000000007700700700700700700707777707777007770007700000000000000000000000770070070070070070070777770777700777000770000000000
00000000000077700700700700700770700070007000007007007770000000000000000000007770070070070070077070007000700000700700777000000000
00000000000777700777700700700707700070007770007007007777000000000000000000077770077770070070070770007000777000700700777700000000
00000000000777000700700700700700700070007000007007000777000000000000000000077700070070070070070070007000700000700700077700000000
00000000000000000700700700700700700070007000007007000000000000000000000000000000070070070070070070007000700000700700000000000000
00000000000000000700700077070700700007007777007770000000000000000000000000000000070070007707070070000700777700777000000000000000
00000000000000000700000000000000000000000000000000000000000000000000000000000000070000000000000000000000000000000000000000000000
